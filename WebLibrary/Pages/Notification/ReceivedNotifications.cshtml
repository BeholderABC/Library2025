@page
@model WebLibrary.Pages.Notification.ReceivedNotificationsModel
@{
    ViewData["Title"] = "我的通知";
}

<section class="section-full">
    <div class="section-inner">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h4 text-primary mb-0"><i class="bi bi-envelope-fill me-2"></i>我的通知</h1>
                <small class="text-muted">最近收到的系统消息与公告</small>
            </div>

            <div class="text-end">
                <a asp-page="./ReceivedNotifications" class="btn btn-outline-secondary me-2"><i class="bi bi-arrow-clockwise"></i> 刷新</a>
                @* 如需“全部已读”操作，可以放一个按钮并绑定处理动作 *@
                @* <button class="btn btn-outline-primary">全部标为已读</button> *@
            </div>
        </div>

        <div class="white-rectangle p-0">
            <div class="rectangle-content p-3">
                @if (Model.Notifications == null || Model.Notifications.Count == 0)
                {
                    <div class="text-center py-5">
                        <i class="bi bi-inbox fs-1 text-muted"></i>
                        <p class="mt-3 mb-0 text-muted">暂无通知</p>
                    </div>
                }
                else
                {
                    <!-- 列表外包一个可滚动容器 -->
                    <div class="list-wrapper">
                        <div class="notification-list">
                            <div class="list-group list-group-flush">
                                @foreach (var n in Model.Notifications)
                                {
                                    var itemClass = n.IsRead ? "list-group-item" : "list-group-item list-group-item-action fw-bold";
                                    <a asp-page="./ReceivedNotificationDetail" asp-route-id="@n.Id" class="@itemClass d-flex align-items-start gap-3">
                                        <div class="flex-shrink-0 mt-1">
                                            @if (!n.IsRead)
                                            {
                                                <span class="notification-dot me-2" title="未读"></span>
                                            }
                                            <i class="bi bi-chat-left-text fs-4 text-primary"></i>
                                        </div>

                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <div class="notification-preview">@n.ContentPreview</div>
                                                    <div class="small text-muted mt-1">
                                                        <i class="bi bi-clock me-1"></i>
                                                        @n.CreateTime.ToString("yyyy-MM-dd HH:mm")
                                                    </div>
                                                </div>

                                                <div class="text-end ms-3">
                                                    @if (n.IsRead)
                                                    {
                                                        <span class="badge bg-secondary"><i class="bi bi-check2-all me-1"></i>已读</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-danger"><i class="bi bi-exclamation-lg me-1"></i>未读</span>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        @* 可选分页或统计 *@
        <div class="mt-3 text-muted small">
            共 @Model.Notifications.Count 条通知
        </div>
    </div>
</section>

<style>
    /* 复用白色长方形样式（若已在全局样式中定义，可移除这段） */
    .white-rectangle {
        background: #fff;
        border-radius: 0.6rem;
        box-shadow: 0 6px 18px rgba(23, 43, 77, 0.06);
    }

    .rectangle-content {
        padding: 1rem;
    }

    .notification-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        background: #dc3545;
        border-radius: 50%;
        border: 2px solid #fff;
        position: relative;
        top: -2px;
    }

    .notification-preview {
        color: #1f2937;
        max-width: 68ch;
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .list-group-item-action {
        transition: background-color .12s ease;
    }

        .list-group-item-action:hover {
            background-color: #f8fafc;
        }

    /* ========== 新增：滚动列表容器 ========== */
    .list-wrapper {
        width: 100%;
    }

    .notification-list {
        /* 高度限制：视口高度的 60% 或不超过 720px */
        max-height: min(60vh, 720px);
        min-height: 220px;
        overflow-y: auto;
        padding-right: 6px; /* 避免内容被滚动条遮挡 */
        -webkit-overflow-scrolling: touch; /* iOS 平滑滚动 */
        box-sizing: content-box;
    }

        /* 滚动条美化（WebKit） */
        .notification-list::-webkit-scrollbar {
            width: 10px;
        }

        .notification-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .notification-list::-webkit-scrollbar-thumb {
            background-color: rgba(23,43,77,0.12);
            border-radius: 10px;
            border: 2px solid #fff;
        }

            .notification-list::-webkit-scrollbar-thumb:hover {
                background-color: rgba(23,43,77,0.18);
            }

    /* Firefox */
    .notification-list {
        scrollbar-width: thin;
        scrollbar-color: rgba(23,43,77,0.12) transparent;
    }

    

    }
</style>
